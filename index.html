<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë‹¬í† ë¼ ë£¨ë‚˜Vell - CUSTOM SCHEDULE</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&family=Gaegu:wght@400;700&family=Gowun+Dodum&family=Nunito:wght@600;800&family=Dongle:wght@400;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    :root{
    :root{
      --contentFont: "Dongle", "Gaegu", "Nanum Pen Script", "Gowun Dodum", sans-serif;
      --contentSize: 28px;
      --contentLine: 1.15;
      --contentTracking: .2px;
    }
      --w: 1920px;
      --h: 1080px;

      --ink: #2f2a3a;
      --soft: rgba(47,42,58,.74);
      --glass: rgba(255,255,255,.72);
      --glass2: rgba(255,255,255,.56);
      --stroke: rgba(64,55,92,.18);

      --violet: rgba(179,156,255,.72);
      --mint: rgba(127,230,200,.62);
      --pink: rgba(255,214,240,.58);
      --blue: rgba(160,210,255,.52);

      --shadow: 0 20px 55px rgba(20,14,40,.18);
      --radius: 28px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 50% 0%, rgba(90,70,150,.45), transparent 60%), #070711;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      font-family:"Gowun Dodum", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--ink);
    }

    #capture{
      width: var(--w);
      height: var(--h);
      position:relative;
      overflow:hidden;
      border-radius: 34px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.26);
      background:
        radial-gradient(1400px 1000px at 10% 18%, var(--violet), transparent 64%),
        radial-gradient(1100px 820px at 90% 24%, var(--mint), transparent 62%),
        radial-gradient(1100px 820px at 52% 104%, var(--pink), transparent 60%),
        radial-gradient(900px 650px at 70% 72%, var(--blue), transparent 62%),
        linear-gradient(135deg, #f6f3ff, #e7fff7);
    }

    .stars, .stars2, .stars3{
      position:absolute; inset:-120px;
      pointer-events:none;
      opacity:.42;
      filter: blur(.15px);
    }
    .stars{
      background-image:
        radial-gradient(circle at 10% 16%, rgba(255,255,255,.95) 0 2px, transparent 3px),
        radial-gradient(circle at 22% 58%, rgba(255,255,255,.75) 0 1.6px, transparent 3px),
        radial-gradient(circle at 44% 22%, rgba(255,255,255,.80) 0 2.1px, transparent 3px),
        radial-gradient(circle at 66% 40%, rgba(255,255,255,.70) 0 1.4px, transparent 3px),
        radial-gradient(circle at 86% 14%, rgba(255,255,255,.85) 0 1.8px, transparent 3px),
        radial-gradient(circle at 92% 78%, rgba(255,255,255,.65) 0 1.4px, transparent 3px),
        radial-gradient(circle at 18% 84%, rgba(255,255,255,.60) 0 1.2px, transparent 3px);
    }
    .stars2{
      opacity:.30;
      background-image:
        radial-gradient(circle at 15% 30%, rgba(255,255,255,.55) 0 1.2px, transparent 3px),
        radial-gradient(circle at 33% 10%, rgba(255,255,255,.50) 0 1.1px, transparent 3px),
        radial-gradient(circle at 55% 35%, rgba(255,255,255,.55) 0 1.2px, transparent 3px),
        radial-gradient(circle at 78% 32%, rgba(255,255,255,.50) 0 1.1px, transparent 3px),
        radial-gradient(circle at 85% 60%, rgba(255,255,255,.55) 0 1.2px, transparent 3px),
        radial-gradient(circle at 28% 72%, rgba(255,255,255,.45) 0 1.0px, transparent 3px);
      transform: rotate(8deg) scale(1.02);
    }
    .stars3{
      opacity:.22;
      background-image:
        radial-gradient(circle at 12% 42%, rgba(179,156,255,.55) 0 2px, transparent 3px),
        radial-gradient(circle at 60% 16%, rgba(127,230,200,.50) 0 2px, transparent 3px),
        radial-gradient(circle at 82% 48%, rgba(255,214,240,.45) 0 2px, transparent 3px);
      filter: blur(0.6px);
    }

    .aurora{
      position:absolute; inset:-90px;
      background:
        radial-gradient(900px 260px at 15% 28%, rgba(127,230,200,.38), transparent 72%),
        radial-gradient(980px 280px at 46% 34%, rgba(179,156,255,.34), transparent 74%),
        radial-gradient(1000px 290px at 75% 40%, rgba(255,214,240,.26), transparent 76%),
        radial-gradient(920px 260px at 88% 58%, rgba(160,210,255,.24), transparent 76%);
      transform: rotate(-7deg);
      opacity:.95;
      pointer-events:none;
      filter: blur(1.2px);
      mix-blend-mode: screen;
    }

    .noise{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.08;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    .moon{
      position:absolute;
      width: 560px; height:560px;
      right: 70px; top: 48px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.98), rgba(255,255,255,.70) 46%, rgba(255,255,255,.18) 72%, transparent 74%),
        radial-gradient(circle at 70% 65%, rgba(179,156,255,.26), transparent 58%);
      box-shadow: 0 28px 85px rgba(179,156,255,.30);
      opacity:.95;
      pointer-events:none;
    }
    .moon:after{
      content:"";
      position:absolute;
      width: 260px; height: 260px;
      right: 112px; bottom: 84px;
      background: rgba(47,42,58,.13);
      border-radius: 140px 140px 96px 96px;
      transform: rotate(-12deg);
      clip-path: polygon(10% 38%, 30% 14%, 48% 8%, 70% 14%, 90% 38%, 94% 62%, 82% 86%, 50% 93%, 18% 86%, 6% 62%);
      opacity:.38;
      filter: blur(.12px);
    }

    .wrap{
      position:absolute;
      inset: 70px 64px 64px 64px;
      display:grid;
      grid-template-columns: 1.10fr .90fr;
      gap: 34px;
      align-items: stretch;
    }

    .card{
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: 0 12px 30px rgba(45,30,80,.08);
      backdrop-filter: blur(12px);
    }

    .left{ padding: 34px 34px 28px 34px; position:relative; overflow:hidden; }
    .title{ display:flex; align-items:flex-end; gap:14px; margin-bottom: 10px; }
    .title h1{
      font-family:"Jua", sans-serif;
      font-size: 78px;
      margin:0;
      line-height:1;
      letter-spacing: 1px;
      text-shadow: 0 4px 0 rgba(255,255,255,.62);
    }
    .badge{
      font-family:"Gaegu", cursive;
      font-weight: 700;
      font-size: 22px;
      padding: 10px 14px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(179,156,255,.46), rgba(127,230,200,.36));
      border: 1px solid rgba(179,156,255,.26);
      color: rgba(47,42,58,.80);
      white-space:nowrap;
    }
    .sub{ margin: 8px 0 0; color: var(--soft); font-size: 18px; }

    .rows{ margin-top: 20px; display:flex; flex-direction:column; gap: 14px; overflow:auto; padding-right:6px; max-height: calc(var(--h) - 220px); }
    .row{ display:grid; grid-template-columns: 180px 1fr; gap: 14px; align-items:start; }

    .day{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-weight: 900;
      font-size: 20px;
      letter-spacing: .4px;
      padding: 14px 16px;
      border-radius: 999px;
      background: rgba(255,255,255,.58);
      border: 1px solid rgba(64,55,92,.14);
      box-shadow: 0 8px 18px rgba(45,30,80,.06);
      text-align:left;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .day span{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .day .delDay{
      width: 34px; height: 34px;
      border-radius: 12px;
      border:none;
      background: rgba(20,18,30,.70);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      font-weight: 900;
      font-family:"Nunito", sans-serif;
      flex: 0 0 auto;
    }
    .day .delDay:hover{ background: rgba(20,18,30,.84); }

    .list{
      border-radius: 22px;
      border: 1px solid rgba(64,55,92,.14);
      background: rgba(255,255,255,.66);
      box-shadow: 0 8px 18px rgba(45,30,80,.06);
      padding: 10px 12px;
      min-height: 58px;
    }
    .list:empty:before{
      content: attr(data-placeholder);
      color: rgba(47,42,58,.35);
      font-weight: 800;
      font-family: var(--contentFont);
      font-size: 28px;

    }

    .item{
      display:grid;
      grid-template-columns: 86px 1fr 34px;
      gap: 10px;
      align-items:start;
      padding: 10px 10px;
      border-radius: 16px;
    }
    .item:nth-child(even){ background: rgba(245,245,255,.55); }

    .time{
      font-family:"Nunito", sans-serif;
      font-weight: 900;
      font-size: 18px;
      color: rgba(47,42,58,.90);
      background: rgba(179,156,255,.20);
      border: 1px solid rgba(179,156,255,.20);
      padding: 8px 10px;
      border-radius: 999px;
      text-align:center;
      white-space:nowrap;
    }
    .text{
      font-family: "Gaegu", "Dongle", "Nanum Pen Script", cursive;
      font-size: 30px;
      letter-spacing: .3px;
      color: rgba(47,42,58,.95);
      line-height: 1.2;
      text-shadow: 0 1px 0 rgba(255,255,255,.6);
      padding: 4px 6px;
    }

    .text:focus{
      background: rgba(255,255,255,.55);
      border-radius: 12px;
      padding: 6px 10px;
      outline: 2px solid rgba(179,156,255,.45);
    }
    .del{
      border:none;
      background: rgba(20,18,30,.70);
      color: rgba(255,255,255,.92);
      width: 34px;
      height: 34px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 900;
      font-family:"Nunito", sans-serif;
    }
    .del:hover{ background: rgba(20,18,30,.84); }

    .spark{
      position:absolute;
      width: 320px; height: 320px;
      left: -120px; bottom: -130px;
      background:
        radial-gradient(circle at 30% 30%, rgba(127,230,200,.78), transparent 62%),
        radial-gradient(circle at 70% 60%, rgba(179,156,255,.68), transparent 64%),
        radial-gradient(circle at 55% 80%, rgba(255,214,240,.50), transparent 66%);
      filter: blur(2.2px);
      opacity: .58;
      pointer-events:none;
    }

    .right{ padding: 26px; display:flex; flex-direction:column; gap: 14px; position:relative; overflow:hidden; }

    .frame{
      border-radius: 240px 240px 34px 34px; /* arch shape */

      flex: 1;
      border-radius: 34px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.84), rgba(255,255,255,.48)),
        radial-gradient(700px 420px at 20% 10%, rgba(255,214,240,.34), transparent 56%),
        radial-gradient(700px 420px at 85% 70%, rgba(127,230,200,.24), transparent 58%);
      border: 2px solid rgba(179,156,255,.30);
      box-shadow: 0 14px 30px rgba(45,30,80,.08);
      position:relative;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* FIX: prevent "stretching" artifacts */
    #photo{
      width:100%;
      height:100%;
      object-fit: contain;           /* default to contain to avoid feeling stretched */
      object-position: center;
      display:none;
      image-orientation: from-image; /* respect EXIF */
      transform: translateZ(0);
    }

    .hint{
      position:absolute; left:18px; right:18px; bottom:18px;
      font-size: 18px;
      color: rgba(47,42,58,.55);
      background: rgba(255,255,255,.58);
      border: 1px dashed rgba(64,55,92,.18);
      border-radius: 18px;
      padding: 10px 12px;
      text-align:center;
      backdrop-filter: blur(10px);
    }
    .watermark{
      position:absolute; top: 16px; right: 16px;
      font-weight: 900;
      letter-spacing: .8px;
      font-size: 16px;
      padding: 10px 14px;
      border-radius: 999px;
      color: rgba(47,42,58,.78);
      background: rgba(255,255,255,.58);
      border: 1px solid rgba(64,55,92,.14);
      backdrop-filter: blur(10px);
      font-family:"Nunito", sans-serif;
    }

    .picker{
      background: var(--glass2);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      padding: 12px;
    }

    .pickerTop{
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
      margin-bottom: 10px; flex-wrap:wrap;
    }
    .pickerTop .label{
      font-weight: 900;
      color: rgba(47,42,58,.78);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .chip{
      font-size: 13px; font-weight: 900;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(179,156,255,.24);
      background: linear-gradient(90deg, rgba(179,156,255,.20), rgba(127,230,200,.16));
      color: rgba(47,42,58,.72);
      white-space:nowrap;
    }

    /* Day creation + entry adder */
    .dayMaker{
      width:100%;
      display:grid;
      grid-template-columns: 1fr 160px;
      gap: 10px;
      margin: 10px 0 12px;
    }
    .dayMaker input, .dayMaker button{
      border-radius: 16px;
      border: 1px solid rgba(64,55,92,.16);
      padding: 12px 12px;
      font-weight: 900;
      font-family: "Gowun Dodum", sans-serif;
      background: rgba(255,255,255,.72);
      color: rgba(47,42,58,.88);
      outline:none;
    }
    .dayMaker button{
      cursor:pointer;
      background: linear-gradient(90deg, rgba(179,156,255,.72), rgba(127,230,200,.58));
      color: rgba(35,28,55,.92);
      box-shadow: 0 10px 18px rgba(45,30,80,.10);
      border: 1px solid rgba(64,55,92,.12);
    }

    .adder{
      width: 100%;
      display:grid;
      grid-template-columns: 1fr 140px 1.6fr 140px;
      gap: 10px;
      margin: 10px 0 12px;
    }
    .adder select, .adder input, .adder button{
      border-radius: 16px;
      border: 1px solid rgba(64,55,92,.16);
      padding: 12px 12px;
      font-weight: 900;
      font-family: "Gowun Dodum", sans-serif;
    }
    .adder select, .adder input{
      background: rgba(255,255,255,.72);
      color: rgba(47,42,58,.88);
      outline:none;
    }
    .adder input::placeholder{ color: rgba(47,42,58,.40); font-weight: 800; }
    .adder button{
      cursor:pointer;
      background: linear-gradient(90deg, rgba(179,156,255,.72), rgba(127,230,200,.58));
      color: rgba(35,28,55,.92);
      box-shadow: 0 10px 18px rgba(45,30,80,.10);
    }

    .thumbGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .thumb{
      position:relative;
      border-radius: 18px;
      border: 1px solid rgba(64,55,92,.16);
      overflow:hidden;
      background: rgba(255,255,255,.62);
      cursor:pointer;
      aspect-ratio: 1 / 1;
      box-shadow: 0 8px 18px rgba(45,30,80,.05);
    }
    .thumb img{ width:100%; height:100%; object-fit: cover; display:block; }
    .thumb .cap{
      position:absolute; left: 10px; right: 10px; bottom: 10px;
      font-size: 12px; font-weight: 900;
      color: rgba(47,42,58,.88);
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(64,55,92,.12);
      padding: 6px 8px;
      border-radius: 999px;
      text-align:center;
      backdrop-filter: blur(10px);
    }
    .thumb.selected{
      outline: 3px solid rgba(179,156,255,.58);
      box-shadow: 0 14px 26px rgba(179,156,255,.20);
    }

    .tools{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .tools .leftTools{ display:flex; gap: 10px; flex-wrap:wrap; align-items:center; }

    .btn, select.ui, .filebtn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(20,18,30,.74);
      color: rgba(255,255,255,.92);
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 900;
      cursor:pointer;
      backdrop-filter: blur(12px);
      display:inline-flex;
      align-items:center;
      gap:10px;
      font-family:"Nunito", sans-serif;
    }
    .btn:hover, select.ui:hover, .filebtn:hover{ background: rgba(20,18,30,.84); }
    input[type="file"]{ display:none; }

    .toast{
      position: fixed;
      right: 18px; bottom: 18px;
      background: rgba(20,18,30,.80);
      color: rgba(255,255,255,.92);
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 900;
      opacity:0;
      transform: translateY(8px);
      transition: .22s ease;
      z-index: 10000;
      pointer-events:none;
      font-family:"Nunito", sans-serif;
    }
    .toast.show{ opacity:1; transform: translateY(0); }

    body.capturing .noCapture, body.capturing .toast{ display:none !important; }
  
    .stars, .stars2, .stars3{
      
    }
    
      50%{opacity:.65}
    }


    /* âœ¨ EXTRA FANCY BACKGROUND */
    #capture::before{
      content:"";
      position:absolute; inset:-200px;
      background:
        radial-gradient(600px 300px at 20% 80%, rgba(255,180,240,.35), transparent 70%),
        radial-gradient(500px 260px at 80% 20%, rgba(180,255,230,.30), transparent 70%),
        radial-gradient(400px 240px at 50% 50%, rgba(200,180,255,.25), transparent 70%);
      pointer-events:none;
      mix-blend-mode:screen;
      
    }

    
      100%{ transform: translateY(-20px) scale(1.05); opacity:1;}
    }

    .sparkleFx{
      position:absolute;
      inset:0;
      pointer-events:none;
      background-image:
        radial-gradient(circle at 15% 25%, rgba(255,255,255,.9) 0 2px, transparent 3px),
        radial-gradient(circle at 35% 70%, rgba(255,255,255,.7) 0 2px, transparent 3px),
        radial-gradient(circle at 75% 40%, rgba(255,255,255,.8) 0 2px, transparent 3px),
        radial-gradient(circle at 60% 85%, rgba(255,255,255,.6) 0 2px, transparent 3px);
      opacity:.45;
      
    }

    
      to{ transform: translateY(-40px); }
    }


    /* ğŸ€ Frame inner decoration (JPG friendly) */
    .frame::before{
      content:"";
      position:absolute;
      inset:14px;
      border-radius: 220px 220px 24px 24px;
      border: 2px dashed rgba(179,156,255,.45);
      pointer-events:none;
      box-shadow:
        inset 0 0 30px rgba(179,156,255,.18),
        0 0 18px rgba(255,214,240,.25);
    }
    .frame::after{
      content:"";
      position:absolute;
      inset:34px;
      border-radius: 200px 200px 18px 18px;
      border: 1px solid rgba(255,255,255,.42);
      pointer-events:none;
      opacity:.7;
    }


    /* ğŸ–¼ï¸ LunaVell background illustration + mixed decorative overlay */
    .decorArt{
      position:absolute;
      inset:0;
      pointer-events:none;
      background: url('assets/bg_lunavell.png') center/cover no-repeat;
      opacity:.60;
      mix-blend-mode: normal;
    }
    .mixOverlay{
      position:absolute;
      inset:0;
      pointer-events:none;
      background: url('assets/bg_overlay_mix.png') center/cover no-repeat;
      opacity:.82;              /* ì€ì€í•˜ê²Œ */
      mix-blend-mode: screen;   /* ë¹›ë‚˜ëŠ” ëŠë‚Œ */
    }

</style>
</head>

<body>
  <div id="capture" aria-label="schedule-canvas">
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>
    <div class="sparkleFx"></div>
    <div class="aurora"></div>
    <div class="decorArt"></div>
    <div class="mixOverlay"></div>
    <div class="moon"></div>
    <div class="noise"></div>

    <div class="wrap">
      <section class="card left">
        <div class="spark"></div>

        <div class="title">
          <h1>SCHEDULE</h1>
          <div class="badge">ë‹¬í† ë¼ ë£¨ë‚˜Vell</div>
        </div>
        <div class="sub noCapture">âœ… ì›í•˜ëŠ” ìš”ì¼ë§Œ ë§Œë“¤ê³ (ì˜¤ë¥¸ìª½) â†’ ì‹œê°„ ê¸°ì¤€ ìë™ ì •ë ¬ â†’ JPG ì €ì¥ âœ¨</div>

        <div class="rows" id="rows"></div>
      </section>

      <section class="card right">
        <div class="frame">
          <img id="photo" alt="character" />
          <div class="watermark">Vell Luna â€¢ Custom</div>
          <div class="hint" id="hint">ì•„ë˜ì—ì„œ ìºë¦­í„° ì„ íƒ ë˜ëŠ” â€˜ì´ë¯¸ì§€ ì—…ë¡œë“œâ€™ë¥¼ ì‚¬ìš©í•´ì¤˜ (ëŠ˜ì–´ë‚¨ ë°©ì§€ ê¸°ë³¸: contain)</div>
        </div>

        <div class="picker noCapture">
          <div class="pickerTop">
            <div class="label">ğŸ€ ìºë¦­í„° ì„ íƒ + ìŠ¤ì¼€ì¤„ ì…ë ¥ <span class="chip">custom days</span></div>
            <div class="tools">
              <div class="leftTools">
                <label class="filebtn" for="fileImg">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                <input id="fileImg" type="file" accept="image/*" />
                <select class="ui" id="fitMode" title="ì´ë¯¸ì§€ ë§ì¶¤">
                  <option value="contain" selected>ì›ë³¸ ë¹„ìœ¨(contain)</option>
                  <option value="cover">ê½‰ ì±„ìš°ê¸°(cover)</option>
                </select>
                
                <select class="ui" id="themeMode" title="í…Œë§ˆ ì„ íƒ">
                  <option value="space" selected>ğŸŒ™ ìš°ì£¼ ëª½í™˜</option>
                  <option value="pastel">ğŸ€ íŒŒìŠ¤í…”</option>
                </select>

                
                <select class="ui" id="seasonMode" title="ê³„ì ˆ í…Œë§ˆ">
                  <option value="spring" selected>ğŸŒ¸ ë´„</option>
                  <option value="summer">ğŸŒ¿ ì—¬ë¦„</option>
                  <option value="autumn">ğŸ ê°€ì„</option>
                  <option value="winter">â„ï¸ ê²¨ìš¸</option>
                </select>

                <select class="ui" id="sizePreset" title="í•´ìƒë„">
                  <option value="1920x1080" selected>1920Ã—1080</option>
                  <option value="1280x720">1280Ã—720</option>
                </select>
              </div>
              <button class="btn" id="btnClearImg">ğŸ§¼ ì´ë¯¸ì§€ ì œê±°</button>
            </div>
          </div>

          <!-- Create custom day -->
          <div class="dayMaker">
            <input id="newDayLabel" placeholder="ìš”ì¼/ë¼ë²¨ ì¶”ê°€ (ì˜ˆ: ì›”, í™”, 2/17 í™”, ì´ë²¤íŠ¸DAY)" />
            <button id="btnAddDay">+ ìš”ì¼ ì¶”ê°€</button>
          </div>

          <!-- Add entry -->
          <div class="adder">
            <select id="addDay" aria-label="ìš”ì¼ ì„ íƒ"></select>
            <input id="addTime" inputmode="numeric" placeholder="00:00" aria-label="ì‹œê°„" />
            <input id="addText" placeholder="ë‚´ìš© (ì˜ˆ: ë°°ê·¸ / ì¢…ê²œ / ì†Œí†µ)" aria-label="ë‚´ìš©" />
            <button id="btnAdd">+ ì¶”ê°€</button>
          </div>

          <div class="thumbGrid" id="thumbGrid"></div>
        </div>

        <div class="tools noCapture" style="margin-top:6px;">
          <button class="btn" id="btnExport">ğŸ“¸ JPGë¡œ ì €ì¥</button>
          <button class="btn" id="btnClear">ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast">ì €ì¥ ì™„ë£Œ!</div>

<script>
  const PRESETS = [
  { name: "ë£¨ë‚˜Vell ê¸°ë³¸ 1", full: "assets/lunavell_01.png", thumb: "assets/thumbs/lunavell_01.png" },
  { name: "ë£¨ë‚˜Vell ê¸°ë³¸ 2", full: "assets/lunavell_02.png", thumb: "assets/thumbs/lunavell_02.png" },
  { name: "ë£¨ë‚˜Vell ê¸°ë³¸ 3", full: "assets/lunavell_03.png", thumb: "assets/thumbs/lunavell_03.png" },
];

  const LS_DAYS = "lunavell_custom_days_v5";
  const LS_ENTRIES = "lunavell_custom_entries_v5"; // {dayId: [{id,t,m,text}]}
  const LS_IMG = "lunavell_schedule_img_v5";
  const LS_PRESET = "lunavell_schedule_preset_v5";
  const LS_FIT = "lunavell_schedule_fit_v5";
  const LS_SIZE = "lunavell_schedule_size_v5";

  const rowsEl = document.getElementById("rows");
  const toastEl = document.getElementById("toast");
  const photoEl = document.getElementById("photo");
  const hintEl = document.getElementById("hint");
  const gridEl = document.getElementById("thumbGrid");
  const daySelectEl = document.getElementById("addDay");

  function showToast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"), 1300);
  }

  function loadJSON(key, fallback){
    try{ return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
    catch(e){ return fallback; }
  }
  function saveJSON(key, value){
    localStorage.setItem(key, JSON.stringify(value));
  }

  function uid(prefix="id"){
    return `${prefix}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`;
  }

  function normalizeTime(raw){
    const s = (raw || "").trim();
    if(!s) return null;
    let hh=null, mm=null;
    if(s.includes(":")){
      const parts = s.split(":").map(p=>p.trim());
      if(parts.length !== 2) return null;
      hh = parts[0]; mm = parts[1];
    }else{
      const digits = s.replace(/\D/g,"");
      if(digits.length === 1 || digits.length === 2){ hh = digits; mm = "00"; }
      else if(digits.length === 3){ hh = digits.slice(0,1); mm = digits.slice(1); }
      else if(digits.length === 4){ hh = digits.slice(0,2); mm = digits.slice(2); }
      else return null;
    }
    const H = Number(hh), M = Number(mm);
    if(!Number.isFinite(H) || !Number.isFinite(M)) return null;
    if(H<0 || H>23 || M<0 || M>59) return null;
    const HH = String(H).padStart(2,"0");
    const MM = String(M).padStart(2,"0");
    return { t:`${HH}:${MM}`, m:H*60+M };
  }

  function getDays(){
    const days = loadJSON(LS_DAYS, []);
    return Array.isArray(days) ? days : [];
  }

  function setDays(days){
    saveJSON(LS_DAYS, days);
  }

  function getEntries(){
    const base = loadJSON(LS_ENTRIES, {});
    return (base && typeof base === "object") ? base : {};
  }

  function setEntries(next){
    saveJSON(LS_ENTRIES, next);
  }

  function sortArr(arr){
    return arr.slice().sort((a,b)=> (a.m-b.m) || (a.text||"").localeCompare(b.text||""));
  }

  function ensureDay(dayId){
    const entries = getEntries();
    if(!Array.isArray(entries[dayId])) entries[dayId] = [];
    setEntries(entries);
  }

  function buildDaySelect(){
    const days = getDays();
    daySelectEl.innerHTML = "";
    if(days.length === 0){
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = "ìš”ì¼ì„ ë¨¼ì € ì¶”ê°€í•´ì¤˜";
      daySelectEl.appendChild(opt);
      daySelectEl.disabled = true;
      return;
    }
    daySelectEl.disabled = false;
    for(const d of days){
      const opt = document.createElement("option");
      opt.value = d.id;
      opt.textContent = d.label;
      daySelectEl.appendChild(opt);
    }
  }

  function render(){
    const days = getDays();
    const entries = getEntries();
    rowsEl.innerHTML = "";

    if(days.length === 0){
      const empty = document.createElement("div");
      empty.style.padding = "16px";
      empty.style.color = "rgba(47,42,58,.70)";
      empty.style.fontWeight = "900";
      empty.textContent = "ì˜¤ë¥¸ìª½ì—ì„œ â€˜ìš”ì¼ ì¶”ê°€â€™ë¥¼ ë¨¼ì € í•´ì¤˜ ğŸŒ™";
      rowsEl.appendChild(empty);
      return;
    }

    for(const d of days){
      const row = document.createElement("div");
      row.className = "row";

      const day = document.createElement("div");
      day.className = "day";
      day.innerHTML = `<span>ğŸŒ™ ${escapeHtml(d.label)}</span><button class="delDay" title="ìš”ì¼ ì‚­ì œ">Ã—</button>`;
      day.querySelector(".delDay").addEventListener("click", ()=>{
        // delete day + its entries
        const nextDays = getDays().filter(x=>x.id !== d.id);
        setDays(nextDays);
        const nextEntries = getEntries();
        delete nextEntries[d.id];
        setEntries(nextEntries);
        buildDaySelect();
        render();
        showToast("ìš”ì¼ ì‚­ì œ!");
      });

      const list = document.createElement("div");
      list.className = "list";
      list.dataset.placeholder = "ì˜ˆ) 21:00 ë°°ê·¸ / 23:00 ì¢…ê²œ / ì†Œí†µ";

      const arr = Array.isArray(entries[d.id]) ? sortArr(entries[d.id]) : [];
      if(arr.length){
        for(const it of arr){
          const item = document.createElement("div");
          item.className = "item";
          item.dataset.id = it.id;
          item.innerHTML = `
            <div class="time">${it.t}</div>
            <div class="text"></div>
            <button class="del" title="ì‚­ì œ">Ã—</button>
          `;
          const textEl = item.querySelector(".text");
          textEl.textContent = it.text || "";

          
          item.querySelector(".del").addEventListener("click", ()=>{
            const next = getEntries();
            next[d.id] = (next[d.id]||[]).filter(x => x.id !== it.id);
            setEntries(next);
            render();
            showToast("ì‚­ì œ!");
          });

          list.appendChild(item);
        }
      }

      row.appendChild(day);
      row.appendChild(list);
      rowsEl.appendChild(row);
    }
  }

  function escapeHtml(s){
    return String(s||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  // Character thumbs
  function clearSelectedThumb(){ gridEl.querySelectorAll(".thumb").forEach(t=>t.classList.remove("selected")); }

  function selectPreset(presetId){
    const p = PRESETS.find(x=>x.id === presetId);
    if(!p) return;
    clearSelectedThumb();
    const btn = gridEl.querySelector(`[data-id="${presetId}"]`);
    if(btn) btn.classList.add("selected");
    localStorage.setItem(LS_PRESET, presetId);
    localStorage.removeItem(LS_IMG);
    applyImage(p.full);
    showToast("ìºë¦­í„° ì ìš©!");
  }

  function buildThumbs(){
    gridEl.innerHTML = "";
    PRESETS.forEach(p=>{
      const item = document.createElement("button");
      item.type = "button";
      item.className = "thumb";
      item.dataset.id = p.id;
      item.innerHTML = `<img alt="${p.name}" src="${p.thumb}"/><div class="cap">${p.name}</div>`;
      item.addEventListener("click", ()=> selectPreset(p.id));
      gridEl.appendChild(item);
    });
  }

  function applyImage(src){
    photoEl.crossOrigin = "anonymous";
    photoEl.src = src;
    photoEl.style.display = "block";
    hintEl.style.display = "none";
  }

  // Upload image
  document.getElementById("fileImg").addEventListener("change", (e)=>{
    const file = e.target.files?.[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      const dataUrl = reader.result;
      clearSelectedThumb();
      localStorage.removeItem(LS_PRESET);
      localStorage.setItem(LS_IMG, dataUrl);
      applyImage(dataUrl);
      showToast("ì—…ë¡œë“œ ì´ë¯¸ì§€ ì ìš©!");
    };
    reader.readAsDataURL(file);
    e.target.value = "";
  });

  // Fit mode (contain/cover) - now really affects "stretch"
  function setFit(value){
    photoEl.style.objectFit = value;
    localStorage.setItem(LS_FIT, value);
  }
  document.getElementById("fitMode").addEventListener("change",(e)=>{
    setFit(e.target.value);
    showToast("ì´ë¯¸ì§€ ë§ì¶¤ ë³€ê²½!");
  });

  function setSizePreset(value){
    if(value === "1280x720"){
      document.documentElement.style.setProperty("--w", "1280px");
      document.documentElement.style.setProperty("--h", "720px");
    }else{
      document.documentElement.style.setProperty("--w", "1920px");
      document.documentElement.style.setProperty("--h", "1080px");
    }
    localStorage.setItem(LS_SIZE, value);
  }
  document.getElementById("sizePreset").addEventListener("change",(e)=>{
    setSizePreset(e.target.value);
    showToast("í•´ìƒë„ ë³€ê²½!");
  });

  // Add custom day
  document.getElementById("btnAddDay").addEventListener("click", ()=>{
    const label = document.getElementById("newDayLabel").value.trim();
    if(!label) return showToast("ìš”ì¼/ë¼ë²¨ì„ ì…ë ¥í•´ì¤˜!");
    const days = getDays();
    const id = uid("day");
    days.push({ id, label });
    setDays(days);
    ensureDay(id);
    document.getElementById("newDayLabel").value = "";
    buildDaySelect();
    // select new day
    daySelectEl.value = id;
    render();
    showToast("ìš”ì¼ ì¶”ê°€!");
  });

  document.getElementById("newDayLabel").addEventListener("keydown",(e)=>{
    if(e.key === "Enter"){
      e.preventDefault();
      document.getElementById("btnAddDay").click();
    }
  });

  // Add entry with sorting
  function addEntry(dayId, timeRaw, text){
    if(!dayId) return {ok:false, msg:"ìš”ì¼ì„ ë¨¼ì € ì¶”ê°€í•´ì¤˜!"};
    const time = normalizeTime(timeRaw);
    if(!time) return {ok:false, msg:"ì‹œê°„ í˜•ì‹ì´ ì´ìƒí•´! ì˜ˆ: 09:30 / 930 / 9"};
    const t = (text||"").trim();
    if(!t) return {ok:false, msg:"ë‚´ìš©ì„ ì…ë ¥í•´ì¤˜!"};

    const next = getEntries();
    if(!Array.isArray(next[dayId])) next[dayId] = [];
    next[dayId].push({ id: uid("e"), t: time.t, m: time.m, text: t });
    next[dayId] = sortArr(next[dayId]);
    setEntries(next);
    return {ok:true};
  }

  document.getElementById("btnAdd").addEventListener("click", ()=>{
    const dayId = daySelectEl.value;
    const timeRaw = document.getElementById("addTime").value;
    const text = document.getElementById("addText").value;

    const res = addEntry(dayId, timeRaw, text);
    if(!res.ok) return showToast(res.msg);

    document.getElementById("addText").value = "";
    document.getElementById("addTime").focus();
    document.getElementById("addTime").select();
    render();
    showToast("ì¶”ê°€ + ì •ë ¬ ì™„ë£Œ!");
  });

  document.getElementById("addText").addEventListener("keydown",(e)=>{
    if(e.key === "Enter"){
      e.preventDefault();
      document.getElementById("btnAdd").click();
    }
  });
  document.getElementById("addTime").addEventListener("keydown",(e)=>{
    if(e.key === "Enter"){
      e.preventDefault();
      document.getElementById("addText").focus();
    }
  });

  // Clear image
  document.getElementById("btnClearImg").addEventListener("click", ()=>{
    localStorage.removeItem(LS_IMG);
    localStorage.removeItem(LS_PRESET);
    photoEl.removeAttribute("src");
    photoEl.style.display = "none";
    hintEl.style.display = "block";
    clearSelectedThumb();
    showToast("ì´ë¯¸ì§€ ì œê±°!");
  });

  // Clear ALL
  document.getElementById("btnClear").addEventListener("click", ()=>{
    localStorage.removeItem(LS_DAYS);
    localStorage.removeItem(LS_ENTRIES);
    render();
    buildDaySelect();
    showToast("ì „ì²´ ì´ˆê¸°í™”!");
  });

  // Export JPG
  document.getElementById("btnExport").addEventListener("click", async ()=>{
    const captureEl = document.getElementById("capture");
    document.body.classList.add("capturing");
    await new Promise(r => setTimeout(r, 120));
    const rect = captureEl.getBoundingClientRect();
    const scale = 2;
    const canvas = await html2canvas(captureEl, {
      backgroundColor: null,
      useCORS: true,
      scale,
      width: rect.width,
      height: rect.height,
      windowWidth: rect.width,
      windowHeight: rect.height,
    });
    document.body.classList.remove("capturing");
    const url = canvas.toDataURL("image/jpeg", 0.95);
    const a = document.createElement("a");
    a.href = url;
    a.download = "lunavell_schedule.jpg";
    a.click();
    showToast("JPG ì €ì¥ ì™„ë£Œ!");
  });

  
  // Theme switch
  function applyTheme(mode){
    const root = document.documentElement;
    if(mode === "pastel"){
      root.style.setProperty("--violet","rgba(255,200,240,.6)");
      root.style.setProperty("--mint","rgba(200,255,230,.6)");
      root.style.setProperty("--pink","rgba(255,220,245,.6)");
      root.style.setProperty("--blue","rgba(210,230,255,.6)");
    }else{
      root.style.setProperty("--violet","rgba(179,156,255,.72)");
      root.style.setProperty("--mint","rgba(127,230,200,.62)");
      root.style.setProperty("--pink","rgba(255,214,240,.58)");
      root.style.setProperty("--blue","rgba(160,210,255,.52)");
    }
    localStorage.setItem("lunavell_theme",mode);
  }

  document.getElementById("themeMode")?.addEventListener("change",(e)=>{
    applyTheme(e.target.value);
  });

  // restore theme
  const savedTheme = localStorage.getItem("lunavell_theme") || "space";
  const themeSel = document.getElementById("themeMode");
  if(themeSel){ themeSel.value = savedTheme; applyTheme(savedTheme); }


  
  // ğŸŒ¸ Season switch (JPG ì „ìš©)
  const LS_SEASON = "lunavell_season_v14";

  function seasonPalette(season){
    // keep it cute + readable
    const map = {
      spring: { violet:"rgba(255,190,225,.56)", mint:"rgba(190,255,230,.52)", pink:"rgba(255,220,245,.50)", blue:"rgba(210,235,255,.46)", baseA:"#fff3fb", baseB:"#f4fffb", overlay:.55 },
      summer: { violet:"rgba(185,215,255,.52)", mint:"rgba(175,255,240,.54)", pink:"rgba(255,225,235,.40)", blue:"rgba(185,235,255,.54)", baseA:"#f0fbff", baseB:"#f6fff2", overlay:.52 },
      autumn: { violet:"rgba(230,190,255,.40)", mint:"rgba(255,225,180,.46)", pink:"rgba(255,210,200,.42)", blue:"rgba(220,210,255,.38)", baseA:"#fff6ee", baseB:"#fffdf6", overlay:.50 },
      winter: { violet:"rgba(200,210,255,.54)", mint:"rgba(210,255,245,.40)", pink:"rgba(255,235,250,.34)", blue:"rgba(205,225,255,.54)", baseA:"#f3f6ff", baseB:"#eef5ff", overlay:.56 },
    };
    return map[season] || map.spring;
  }

  function applySeasonMode(season){
    const p = seasonPalette(season);
    const captureEl = document.getElementById("capture");
    if(captureEl){
      captureEl.style.background = [
        `radial-gradient(1400px 1000px at 10% 18%, ${p.violet}, transparent 64%)`,
        `radial-gradient(1100px 820px at 90% 24%, ${p.mint}, transparent 62%)`,
        `radial-gradient(1100px 820px at 52% 104%, ${p.pink}, transparent 60%)`,
        `radial-gradient(900px 650px at 70% 72%, ${p.blue}, transparent 62%)`,
        `linear-gradient(135deg, ${p.baseA}, ${p.baseB})`
      ].join(",");
    }
    // overlay strength
    const overlayEl = document.querySelector(".mixOverlay");
    if(overlayEl) overlayEl.style.opacity = String(p.overlay);
    localStorage.setItem(LS_SEASON, season);
  }

  // Wire UI
  const seasonSel = document.getElementById("seasonMode");
  if(seasonSel){
    seasonSel.addEventListener("change", (e)=> applySeasonMode(e.target.value));
    const saved = localStorage.getItem(LS_SEASON) || "spring";
    seasonSel.value = saved;
    applySeasonMode(saved);
  }else{
    // if UI missing, still apply stored season
    applySeasonMode(localStorage.getItem(LS_SEASON) || "spring");
  }


  // Init
  buildThumbs();

  // Restore fit/size
  const savedFit = localStorage.getItem(LS_FIT) || "contain";
  document.getElementById("fitMode").value = savedFit;
  setFit(savedFit);

  const savedSize = localStorage.getItem(LS_SIZE) || "1920x1080";
  document.getElementById("sizePreset").value = savedSize;
  setSizePreset(savedSize);

  // Restore image
  const savedImg = localStorage.getItem(LS_IMG);
  const savedPreset = localStorage.getItem(LS_PRESET);
  if(savedImg){
    applyImage(savedImg);
  }else if(savedPreset){
    selectPreset(savedPreset);
  }

  // Ensure structures + render
  buildDaySelect();
  render();

  // If no days at all, add a friendly starter day (optional)
  // (leave empty to match your request: "ì›í•˜ëŠ” ìš”ì¼ë§Œ ì¶”ê°€")
</script>
</body>
</html>
